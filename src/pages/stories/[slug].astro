---
import { changeLanguage } from 'i18next';
import Article from '@/components/Article.astro';
import Layout from '@/layouts/Layout.astro';
import type { IStory, MetadataItem } from '@/types';
import { fetchRowsFromDatabase } from '@/utils/baserow';

changeLanguage('en');

export async function getStaticPaths() {
  const baserowData = await fetchRowsFromDatabase(
    '&sources__join=author&related_wikidata__join=type',
  );
  const baserowResult = await baserowData.results;
  const stories: Array<{
    frontmatter: IStory;
    default: any;
  }> = Object.values(import.meta.glob('@/stories/en/*.md', { eager: true }));
  return stories.map((story) => ({
    params: { slug: story.frontmatter.slug },
    props: {
      story,
      baserow:
        baserowResult.find(
          (item: MetadataItem) => item.slug === story.frontmatter.slug,
        ) ?? null,
    },
  }));
}
const { story, baserow } = Astro.props;
const { frontmatter } = story;
const currentUrl = Astro.url.href;
---

<Layout
  title={`${frontmatter.title} - Stories | Otibeguni `}
  schema={{
    '@context': 'https://schema.org',
    '@type': 'Book',
    name: frontmatter.title,
    author: frontmatter.source,
    url: currentUrl,
  }}
>
  <Article story={story} baserow={baserow} />
</Layout>
